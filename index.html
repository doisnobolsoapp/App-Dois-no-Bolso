<script>
  // Vari√°vel global para o deferred prompt
  let deferredPrompt;

  console.log('üöÄ Dois no Bolso inicializando...');

  // Remover Service Workers existentes em desenvolvimento
  if ('serviceWorker' in navigator) {
    const isDevelopment = window.location.hostname === 'localhost' || 
                         window.location.hostname === '127.0.0.1';
    
    if (isDevelopment) {
      console.log('üîß Ambiente de desenvolvimento - Removendo Service Workers...');
      
      // Desregistrar todos os Service Workers
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for (let registration of registrations) {
          registration.unregister();
          console.log('üóëÔ∏è Service Worker removido:', registration.scope);
        }
      }).catch(function(error) {
        console.log('‚úÖ Nenhum Service Worker para remover');
      });
    }
  }

  // Remover tela de loading quando o app carregar
  window.addEventListener('load', function() {
    console.log('‚úÖ P√°gina totalmente carregada');
    
    // Verificar se o React j√° carregou
    const checkReactLoaded = setInterval(() => {
      const rootElement = document.getElementById('root');
      if (rootElement && rootElement.hasChildNodes()) {
        console.log('‚úÖ React carregou com sucesso');
        clearInterval(checkReactLoaded);
        
        // Remover loading
        setTimeout(() => {
          const loadingElement = document.getElementById('app-loading');
          if (loadingElement) {
            loadingElement.style.opacity = '0';
            setTimeout(() => {
              if (loadingElement.parentNode) {
                loadingElement.remove();
                console.log('üéØ Loading removido');
              }
            }, 300);
          }
        }, 1000);
      }
    }, 100);

    // Timeout de seguran√ßa - remover loading ap√≥s 8 segundos
    setTimeout(() => {
      const loadingElement = document.getElementById('app-loading');
      const rootElement = document.getElementById('root');
      
      if (loadingElement && loadingElement.parentNode && rootElement && !rootElement.hasChildNodes()) {
        console.log('‚ö†Ô∏è React n√£o carregou - mostrando fallback');
        loadingElement.innerHTML = `
          <div class="text-center text-white p-8">
            <div class="text-4xl mb-4">‚ö†Ô∏è</div>
            <h2 class="text-xl font-bold mb-2">Sistema n√£o carregou</h2>
            <p class="mb-4">Verifique o console (F12) para erros</p>
            <button onclick="location.reload()" class="bg-white text-green-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100">
              Recarregar
            </button>
            <button onclick="clearServiceWorkers()" class="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 ml-2">
              Limpar Cache
            </button>
          </div>
        `;
      }
    }, 8000);
  });

  // Fun√ß√£o para limpar Service Workers manualmente
  window.clearServiceWorkers = function() {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for (let registration of registrations) {
          registration.unregister();
          console.log('üßπ Service Worker removido:', registration.scope);
        }
        alert('Service Workers removidos! Recarregando...');
        location.reload();
      });
    }
  };

  // PWA - Capturar evento de instala√ß√£o (apenas em produ√ß√£o)
  window.addEventListener('beforeinstallprompt', (e) => {
    console.log('üì± PWA pronto para instala√ß√£o');
    e.preventDefault();
    deferredPrompt = e;
  });

  // Detectar modo standalone
  if (window.matchMedia('(display-mode: standalone)').matches) {
    console.log('üì± Executando em modo standalone');
    document.documentElement.classList.add('standalone-mode');
  }

  // Gerenciar estado online/offline
  window.addEventListener('online', () => {
    console.log('‚úÖ Conex√£o restaurada');
  });

  window.addEventListener('offline', () => {
    console.log('üì∂ Modo offline ativado');
  });

  console.log('‚úÖ Dois no Bolso inicializado!');
</script>
